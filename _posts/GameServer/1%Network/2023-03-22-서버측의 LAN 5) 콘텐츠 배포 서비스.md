---
title: 서버측의 LAN 5) 콘텐츠 배포 서비스
categories: 1%Network
tags: 
toc: true
toc_sticky: true
---

이 포스트는 Tsutomu tone의 <성공과 실패를 결정하는 1%의 네트워크 원리(성안당)> 내용을 바탕으로 공부한 내용을 정리한 것입니다. 

# **1. 콘텐츠 배포 서비스**

캐시 서버를 서버측에 두면 웹 서버 부하가 경감되지만 트래픽은 억제할 수 없다. 반면 클라측에 두면 혼잡에 휘말리지 않아 패킷 흐름이 안정되지만, 클라측 네트워크 관리자가 캐시 서버를 소유하므로 웹 서버 운영자가 이를 제어할 수 없다. 이때 프로바이더와 계약하여 웹 서버 운영자가 제어할 수 있는 캐시 서버를 클라 측 프로바이더에 두면 양쪽의 장점을 모두 취할 수 있다. 

이 방법을 전면적으로 실현하려면 프로바이더의 POP 전부에 캐시 서버를 설치해야 되므로 비용이 많이 든다. 따라서 중요한 프로바이더에 중점을 두어 캐시 서버를 줄이고 있다. 그럼에도 캐시 서버 설치에는 비용이 많이 들기 때문에 캐시 서버를 설치하고 이를 웹 서버 운영자에게 대출하는 서비스들이 제공되고 있는데, 이를 두고 콘텐츠 배포 서비스라고 한다. 

이러한 서비스를 제공하는 사업자를 CDSP, Content Delivery Service Provider이라 하는데, 그들은 중요 프로바이더와 계약한 뒤 그곳에 다수의 캐시 서버를 설치한다. 그 후 웹 서버 운영자들과 계약하여 이들을 연대시킨다. 캐시 서버는 다수의 웹 서버 데이터를 저장할 수 있으므로 웹 서버 운영자는 비용을 절감할 수 있으며 프로바이더와의 계약은 CDSP가 한번에 인수하므로 이에 대한 부담도 줄어든다.

<br/>

# **2. 캐시 서버 액세스**

콘텐츠 배포 서비스를 이용하는 경우, 가장 가까운 캐시 서버를 찾아내어 클라가 여기에 엑세스 하도록 중재하는 구조가 필요하다. 가까운 캐시 서버에 액세스 하는 첫번째 방법은 DNS 서버에서 웹 서버 IP 주소를 회답할 때 가장 가까운 캐시 서버 IP 주소를 회답하도록 설정하는 것이다. 이때 캐시 서버 설치 장소의 라우터들에서 경로표를 모아두었다가, 이를 이용해 대략적인 거리를 판단한다.

HTTP 헤더의 Location 필드를 활용할 수도 있다. 이는 여기 말고 저 서버에 액세스 하라는 의미로 사용하는 것으로, 이러한 처리를 리다이렉트라고 부른다. 우선 리다이렉트용 서버를 웹 서버측 DNS에 등록하고, 리다이렉트용 서버에 라우터로부터 경로표를 모아둔다. 그럼 클라가 HTTP 리퀘스트를 보냈을 때 가장 가까운 캐시 서버를 Location 헤더에 붙여 응답하고 이후 클라이언트가 그곳으로 액세스 하게 된다. 

이 방법은 리다이렉트 HTTP 메시지의 대화가 증가하므로 앞선 방법보다 오버헤드가 생기지만, 대신 정밀도가 높다. 앞선 방법은 클라측 DNS 서버와 캐시 서버 거리를 계산한 반면 이 방법은 송신처 IP 주소와 캐시 서버 거리를 계산하기 때문이다. 또, 리다이렉트용 서버를 사용하면 시험적으로 패킷을 보내 왕복 시간 구하고, 이를 바탕으로 최적의 캐시 서버에 액세스 하도록 안내할 수도 있다. 
