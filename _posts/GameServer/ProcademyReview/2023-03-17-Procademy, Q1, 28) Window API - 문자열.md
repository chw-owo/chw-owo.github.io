---
title: Procademy, Q1, 28) Window API - 문자열
categories: ProcademyReview
tags: 
toc: true
toc_sticky: true
---

이 포스트는 프로카데미 (게임 서버 아카데미) 수업을 바탕으로 공부한 내용을 정리한 것입니다. 

# **1. 유니코드와 인코딩**

유니코드가 꼭 2byte 이상을 쓰는 것은 아니다. ASCII는 표의 번호가 1:1로 대응되는 것이라 그 자체로 곧 인코딩이지만 유니코드는 인코딩 방식에 따라 기본이 2byte일 수도, 1byte일 수도 있다. 유니코드는 글자에 번호를 매긴 표일 뿐이므로 유니코드와 유니코드 인코딩을 구분해야 한다.

UTF-8로 인코딩 할 경우 1Byte를 기본 단위로 쓰며, 영어는 ASCII 코드와 동일하게 매핑된다. 2Byte는 2Byte로 표현하되 최소 단위가 1Byte가 되는 것이다. html 과 같은 양식 자체가 기본적으로 영어이므로 웬만한 상황에서는 UTF-8을 사용하는 게 UTF-16보다 네트워크 트래픽을 훨씬 줄일 수 있다. 

UTF-8에서 한글을 쓰게 되면 자체적으로 쓰는 데이터 용량으로 인해 3Byte가 되므로, 만약 한글만 사용하는 상황이라면 UTF-16이 더 효율적이다. UTF-16에서 3Byte를 쓰게 되면 이는 4Byte로 넘어간다. 윈도우는 다양한 언어를 쓸 일이 많으므로 UTF-16을, 리눅스는 주로 영어를 사용하므로 UTF-8를 기본값으로 갖는다. 

유니코드를 쓰면 인코딩 방식과 함께 바이트 정렬 정보도 필요하게 된다.  윈도우에서는 BOM 코드를 이용하면 인코딩 방식과 바이트 오더에 대한 코드를 파일 최상단에 저장하여 다른 뷰어가 참조할 수 있도록 한다. 단, 리눅스 웹서버에 올릴 때, txt를 바이너리로 읽을 때 등의 경우엔 BOM 코드 설정을 끄도록 주의해야 한다. 

SBCS, MBCS, WBCS는 글자를 표현에 드는 용량을 의미하므로 유니코드가 MBCS인지 WBCS인지는 다소 애매하며, 실제로 자주 사용되는 표현은 아니다.

<br/>

# **2. C++과 문자열**

Visual Studio에서 속성 - 고급 - 문자 집합으로 가보면 유니코드 / 멀티바이트를 선택할 수 있다. 이것을 설정하면 #define이 한 줄 추가되며 이는 중립 자료형 (ex TCHAR, __TEXT)에 대해서만 적용이 된다. 이 외의 경우에서는 설정과 상관 없이 문자열 앞에 L을 붙이면 UTF-16, 안붙이면 ANSI가 된다. 

비스타로 넘어오면서 TextOut, CreateFile처럼 문자열을 인자로 받는 윈도우 API 함수들이 ~A, ~W 두가지 버전으로 분리되었고, 기존의 함수들은 이를 define 하는 매크로가 되었다. 이들은 내부적으로 중립 자료형을 사용하기 때문에 문자 집합 설정을 바꾸면 이것도 어떤 버전을 사용할지 자동으로 결정이 된다. 

유니코드로 전환되는 과도기에는 중립 자료형을 권장했으나, 최근에는 모든 환경에서 W 형태가 지원되기 때문에 W 시리즈를 권장한다. visual studio에서도 기본 템플릿 프로젝트의 T를 모두 W로 변경되었으며, 최근에는 유니코드를 지원하지 않는 곳을 찾아보기 힘들기 때문에 두가지 상황을 모두 대비할 이유가 없다.