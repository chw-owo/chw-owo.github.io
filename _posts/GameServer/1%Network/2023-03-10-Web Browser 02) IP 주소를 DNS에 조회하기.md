---
title: Web Browser 02) IP 주소를 DNS에 조회하기
categories: 1%Network
tags: 
toc: true
toc_sticky: true
---

이 포스트는 Tsutomu tone의 <성공과 실패를 결정하는 1%의 네트워크 원리(성안당)> 내용을 바탕으로 공부한 내용을 정리한 것입니다. 

# **1. IP 주소의 기본**

브라우저는 URL 해독, HTTP 메시지 생성의 기능을 하지 네트워크에 송출하는 기능은 갖고 있지 않다. 따라서 HTTP의 메세지를 만들고 나면 이것을 OS에 의뢰하여 엑세스 대상 웹서버에 송신하게 된다. 이때 URL 안에 쓰여있는 서버의 도메인명에서 IP 주소를 조사하는데, OS에 송신을 의뢰할 때는 도메인명이 아니라 주소로 송신자를 지정해야 하기 때문이다.  

TCP/IP는 라우터로 서브넷에 접속하여 네트워크를 만든 것으로, 인터넷이나 사내 LAN도 이 개념에 기초해 만들어진다. 허브에 몇대의 PC가 접속된 것을 묶어서 서브넷이라고 부르며, 이를 라우터에서 연결하면 네트워크가 완성된다. 이때 각 서브넷에 네트워크 번호를, 각 PC에 호스트 번호를 부여하여 주소로 사용하는데 이 둘을 합쳐서 IP 주소라고 부른다. 

실제 IP 주소는 32bit 디지털 데이터로, 이를 1byte씩 점으로 구분하여 10진수로 표현한다. 어디까지가 호스트 번호인지는 사용자가 직접 넷마스크를 통해 결정한다. IP 주소 뒤에 슬래쉬(/)를 기준으로 넷마스크를 표기하는데 bit 수로 표기하기도 하고, 네트워크 번호 부분을 1 호스트 번호 부분을 0으로 하여 255.255.255.0 처럼 표기하기도 한다. 이때 호스트 번호의 bit가 모두 0이면 서브넷 그 자체를 의미하며, 모두 1이면 서브넷에 대한 브로드캐스트를 의미한다. 

라우터는 IP 주소를 바탕으로 데이터를 중계한다. 송신측이 메세지를 보내면 우선 서브넷 안에 있는 허브가 운반하여 가장 가까운 라우터에 도착한다. 라우터는 메시지 보낸 상태를 확인하여 다음 라우터를 판단, 송신 동작을 실행하면 다시 서브넷의 허브가 라우터까지 메시지를 보낸다. 이 과정을 반복하여 최종적으로 상대의 데이터가 도착하는 것이 IP 주소의 기본 개념이다. 

<br/>

# **2. 리졸버를 이용한 DNS 조회**

브라우저가 URL을 바탕으로 가장 가까운 DNS 서버에 조회 메시지를 보내면, 응답 메시지로부터 IP 주소를 알 수 있게 된다. 이때 DNS 서버에서 클라이언트 역할을 하는 것을 두고 DNS Resolver라고 부르며, DNS 원리로 IP 주소를 조사하는 것을 Name Resolution이라고 한다. Socket 라이브러리는 OS에 포함된 네트워크 기능을 애플리케이션에서 호출할 수 있도록 지원하는데, Resolver도 이 안에 포함되어 있다. 

Resolver 프로그램 이름(ex gethostbyname)과 웹서버의 이름을 나란히 쓰면 Resolver를 호출할 수 있다. Resolver를 호출하면 조회 메시지를 보내고, 응답 메시지를 받고, 응답 안의 IP 주소를 추출하여 반환하는 일련의 과정이 이루어진다. 브라우저가 웹 서버에 메시지를 보낼 때는 반환 받은 메모리 영역에서 IP 주소를 추출해 HTTP 리퀘스트 메시지와 함께 OS에 송신을 의뢰하면 된다. 

조금 더 자세히 보자면, 네트워크 애플리케이션(ex 브라우저 등)이 Resolver를 호출할 때 애플리케이션 동작이 일시 정지되고 제어가 Resolver로 넘어간다. 그 후 DNS 서버에 메시지를 보내는데, 이때 Resolver는 네트워크에 대해 데이터를 송수신할 수 없으므로 이러한 송신은 OS 프로토콜 스택을 호출하여 실행을 의뢰하게 된다. 그럼 여기에서 LAN 어댑터를 통해 메시지를 송신한다. 이때 DNS 서버의 IP 주소는 컴퓨터에 미리 설정되어 있는 주소를 사용한다. 

액세스 대상의 웹 서버가 DNS 서버에 등록되어 있을 경우 답을 응답 메시지에 써서 클라이언트에게 반송하고, 이는 프로토콜 스택을 경유하여 Resolver에게 전달된다. 그럼 Resolver는 IP 주소를 추출하여 애플리케이션에서 지정해두었던 메모리 영역에 건네주게 된다. 그 후 제어가 다시 애플리케이션에 돌아오면 이 메모리 영역에 저장된 값을 통해 IP 주소를 사용할 수 있게 된다. 