---
title: XSS와 CSRF
categories: Web
tags: Web
toc: true
toc_sticky: true
---

## 📌 XSS

Cross(X) Site Scripting

![image](https://user-images.githubusercontent.com/96677719/151336266-2f44b7ec-94f4-4376-bee4-c53366af8ec4.png)

![image](https://user-images.githubusercontent.com/96677719/151336800-e245bd78-af34-4a96-9434-221d70e72785.png)


웹 상에서 가장 기초적인 취약점 공격 방법의 일종으로, 악의적인 사용자가 공격하려는 사이트에 스크립트를 넣는 기법을 말한다. 주로 다른 웹사이트와 정보를 교환하는 식으로 작동하므로 사이트 간 스크립팅이라고 명칭한다. 이 취약점은 웹 애플리케이션이 사용자로부터 입력 받은 값을 제대로 검사하지 않고 사용할 경우 나타나며, 공격에 성공하면 사이트에 접속한 사용자는 삽입된 코드를 실행하게 된다. 보통 의도치 않은 행동을 수행시키거나 쿠키나 세션 토큰 등의 민감한 정보를 탈취한다. 크로스 사이트 스크립팅은 자바스크립트를 사용하여 공격하는 경우가 많다. 공격 방법이 단순하고 가장 기초적이지만, 많은 웹사이트들이 XSS에 대한 방어 조치를 해두지 않아 공격을 받는 경우가 많다. 여러 사용자가 접근 가능한 게시판 등에 코드를 삽입하는 경우도 많으며, 경우에 따라서는 메일과 같은 매체, 심지어는 닉네임에 코드를 심기도 한다.

예를 들어 input태그 안에 js<script> alert('메롱') </script>를 주입하고 submit으로 서버에 저장을 하게 되면 서버는 그대로의 코드를 서버로 저장하고 다른 유저가 해당 글을 읽게 되면 script가 실행되어 사용자 화면에 alert명령이 실행된다.

![image](https://user-images.githubusercontent.com/96677719/151335587-a5117df6-6be3-4ed7-af7c-e66f6b32ef12.png)

![image](https://user-images.githubusercontent.com/96677719/151335643-4d5513ed-1a6a-4ff1-a67d-6c5f8aa7b9ff.png)

## 방어

스크립트 태그에 자주 사용되는 <, > 등 과 같은 문자를 필터링 해주는 방법으로 방어 할 수 있다.n문자 입력을 그대로 표시하지 않고, 입력 시 문자 참조(HTML entity)로 필터링하고, 서버에서 브라우저로 전송 시 문자를 인코딩하는 것이다.

## 📌 CSRF

### CSRF란?

Cross Site Request Forgery


![image](https://user-images.githubusercontent.com/96677719/151336132-169c4415-e213-422a-a8c2-7e3e5e6c1575.png)

웹 사이트 취약점 공격의 하나로, 사용자가 자신의 의지와는 무관하게 공격자가 의도한 행위(수정, 삭제, 등록 등)를 특정 웹사이트에 요청하게 하는 공격을 말한다. 사이트 간 스크립팅(XSS)을 이용한 공격이 사용자가 특정 웹사이트를 신용하는 점을 노린 것이라면, 사이트간 요청 위조는 특정 웹사이트가 사용자의 웹 브라우저를 신용하는 상태를 노린 것이다. 일단 사용자가 웹사이트에 로그인한 상태에서 사이트간 요청 위조 공격 코드가 삽입된 페이지를 열면, 공격 대상이 되는 웹사이트는 위조된 공격 명령이 믿을 수 있는 사용자로부터 발송된 것으로 판단하게 되어 공격에 노출된다. CSRF는 공격자가 사용자의 컴퓨터를 감염시키거나 사이트 해킹을 해서 이뤄지는 공격이 아니므로  공격이 성공하려면 위조 요청을 전송하는 서비스(ex : 페이스북)에 희생자가 로그인 상태여야하고, 또 희생자는 공격자가 만든 피싱 사이트에 접속해야한다.

```
<img src="http://auction.com/changeUserAcoount?id=admin&password=admin" width="0" height="0">
```

예를 들어 위와 같은 코드가 있다면 다음과 공격이 같이 진행된다. 
 
우선 옥션 관리자 중 한명이 관리 권한을 가지고 회사내에서 작업을 하던 중 메일을 조회한다. 이때, 로그인이 이미 되어있다고 가정하면 관리자로서의 유효한 쿠키를 갖고있다. 그리고 해커는 위와 같이 태그가 들어간 코드가 담긴 이메일을 보낸다. 관리자는 이미지 크기가 0이므로 전혀 알지 못할 것이다. 피해자가 이메일을 열어볼 때, 이미지 파일을 받아오기 위해 URL이 열리고 해커가 원하는 대로 관리자의 계정이 id와 pw 모두 admin인 계정으로 변경된다.

### 방어

Referer 체크: HTTP 헤더에 있는 Referer로 해당 요청이 요청된 페이지의 정보를 확인하는 방법으로 간단하여 소규모 웹사이트에 주로 이용된다. 하지만 해당 정보는 Paros나 Zap, fiddler같은 프로그램으로 조작이 가능하다.

GET / POST 요청 구분: img 태그 등의 경우 GET 요청으로, form 태그로 값을 받을 경우 POST를 이용하여 요청을 구분해준다.

Token 사용: 서버에서 hash로 암호화 된 token을 발급, 사용자는 매 요청마다 token을 함께 보내어 서버의 검증을 거쳐야한다.
추가 인증 수단 사용 ( ex. CAPCHA )

또, 추가 인증 수단을 거쳐 만약 테스트를 통과하지 못할 시, 해당 요청 자체를 거부하는 방법이 있다.

## 📌 XSS vs CSRF

XXS는 악성 스크립트가 클라이언트에서 실행되는 반면 CSRF는 권한을 도용당한 클라이언트가 가짜 요청을 서버에 전송하는 방식으로 이루어진다.

XXS의 공격 대상은 클라이언트, CSRF의 공격 대상은 서버다.

XXS의 목적은 쿠키ㆍ세션 갈취, 웹사이트 변조 등이고, CSRF의 목적은 주로 권한 도용이다.


### 출처

https://lucete1230-cyberpolice.tistory.com/23

https://swk3169.tistory.com/24

https://velog.io/@tsi0521/CSRF-XSS-%EA%B3%B5%EA%B2%A9


