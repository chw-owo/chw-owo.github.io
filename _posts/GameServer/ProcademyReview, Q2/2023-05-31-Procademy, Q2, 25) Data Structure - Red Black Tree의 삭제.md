---
title: Procademy, Q2, 25) Data Structure - Red Black Tree의 삭제
categories: ProcademyReview
tags: 
toc: true
toc_sticky: true
---

이 포스트는 프로카데미 (게임 서버 아카데미) 수업을 바탕으로 공부한 내용을 정리한 것입니다. 

# **1. Red Black Tree의 삭제**

삭제 자체는 이진 트리의 삭제와 동일한 과정을 거친다. 이후 삭제되었던 노드의 자식 노드, 즉 삭제된 자리에 들어온 노드를 중심으로 밸런스 맞추는 작업을 진행한다. 만약 삭제한 노드가 레드라면 진행하지 않으며, 그 자리를 대체한 자식 노드가 레드라면 이를 블랙으로 바꾸고 반환한다. 이때 이진 트리 삭제의 특성으로 인해 최종 삭제된 노드는 (Nil 제외) 자식이 하나 이하이다. 

블랙을 삭제하면 부모 기준 삭제한 쪽 경로의 블랙 노드 개수가 -1이 된다. 따라서 부모 노드를 기준으로 회전과 색 변환을 통해 균형을 맞출 수 있다면 맞출 것이다. 만약 맞출 방법이 없다면 부모 노드 기준 반대측 노드의 블랙을 레드로 바꾸어 시야 내의 균형을 맞춘 다음, 부모 노드를 pNode로 바꾸어 균형 잡아야 할 대상을 위로 올릴 것이다. 이때 부모의 색이 중요하지 않다. pNode가 레드라면 이를 블랙으로 바꾸고 반환하면 되기 때문이다. 

**1.** 삭제 노드의 형제가 블랙이고 형제의 양쪽 자식이 블랙 

만약 형제와 형제의 자식 노드가 모두 블랙이라면 이 안에서 균형 맞출 방법이 없다. 따라서 일단 형제를 레드로 바꿔서 현재 시야 안에서만이라도 균형을 맞추고 부모 노드로 재귀한다. 이때 부모 노드가 레드라면 이를 블랙으로 바꾸는 것으로 상황이 해결된다. 

**2.** 형제가 레드

형제가 레드일 때도 할 수 있는 게 없다. 따라서 형제를 블랙으로, 부모를 레드로 바꾸어 부모 기준 좌회전함으로써 pNode의 형제가 블랙인 상황을 만들어준다. 형제가 레드라면 형제는 블랙이 존재하는 두 자식 라인을 가지고 있을 것이다. 이때 좌회전을 하면 형제가 부모가 되면서 형제의 기존 왼자식이 내쪽으로 넘어오게 되면서 pNode의 새로운 형제가 블랙이 된다. 이때 형제가 레드므로 부모나 그의 자식은 레드일 리 없다. 

이렇게 형제가 블랙인 상태를 만들었다면현재노드를 기준으로 처음부터 재작업한다. 이 경우는 좌회전으로 삭제노드 방향이 한칸씩 내려가며 되려 더 깊이가 깊어진 상태로 재검사를 하게 된다. 

**3.** 형제가 블랙, 형제의 왼자식이 레드, 오른자식은 블랙

형제의 왼자식을 블랙으로, 형제를 레드로 만들고 형제 기준으로 우회전한다. 블랙으로 만든 자식을 부모로 올리고, 기존의 부모는 레드로 바꾸는 것이다. 이를 통해 4번 상황을 만들 수 있다. 재귀하지 않고 바로 4번 계산을 진행한다. 

**4.** 형제가 블랙, 형제의 오른 자식이 레드

형제 컬러를 부모 컬러로, 부모와 형제의 오른자식은 블랙으로 바꾼 뒤 부모 기준 좌회전한다. 이 상황에서는 형제 자식인 레드를 블랙으로 변경하고 회전시킴으로써 이쪽 측면의 블랙을 증가시킬 수 있다. 부모의 컬러를 형제에게 넣으므로서 회전 후 부모의 색상은 동일할 것이다. 기존 부모를 블랙으로 바꾸고 회전시켜서 삭제된 경로 쪽으로 넘기면 형제 측의 블랙이 -1이 된다. 이때 형제의 레드 자식을 블랙으로 바꾸면 좌우 균형을 맞출 수 있다. 