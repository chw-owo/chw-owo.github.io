---
title: Procademy, Q1, 15 - 2) 게임의 구조
categories: ProcademyReview
tags: 
toc: true
toc_sticky: true
---

이 포스트는 프로카데미 (게임 서버 아카데미) 수업을 바탕으로 공부한 내용을 정리한 것입니다. 

# **1. CS (Client/Server)**

게임 구조는 기본적으로 플레이어 간 네트워크를 어떻게 연결하는지, 누가 게임 로직을 처리하는 지에 따라 크게 P2P와 CS로 나뉜다. 이 중CS는 게임 서버에서 모든 클라의 명령을 처리, 즉 모든 로직의 처리를 전담하는 방법이다. 서버에서 모든 걸 주도해서 처리하고 클라에서는 렌더만 하는 것이 가장 이상적인 CS의 형태이다. 이 경우 핵이 불가능하며 일관성 있게 동기화 된 결과 처리가 이루어진다. 단 응답성 및 정교한 처리에 있어서 어려움이 있고, 유지 비용이 많이 들 수 있다. 

액션성이 강한 게임, 컨트롤이 많은 게임, 논타겟팅 전투 방식의 MMORPG게임이 흔하지 않았던 이유도 서버에서 정교한 충돌처리가 어려웠기 때문이다. 단 최근에는 서버 기술 및 네트워크 환경의 발달로 CS 구조의 액션 게임, 논타겟팅 MMORPG가 개발되고 있다. 참고로 타겟팅이면서도 논타겟팅처럼 구현할 수도 있다. 클라에서 충돌판정한 뒤 충돌된 물체에 대한 판정만 서버에서 진행하는 것이다. 오버워치가 대표적인 CS 구조인데 충돌 처리를 서버에서 하다보니, 화살에 맞지 않았는데 맞았다고 판정이 뜨는 경우가 간혹 있다. 

# **2. P2P (Peer to Peer)**

클라이언트끼리 연결시켜서 통신하는 방법으로 일반 P2P와 Super P2P로 나뉜다. 적은 인원이 함께 게임하는 MO류 게임에서 많이 사용된다. 클라에서 직접 로직을 처리하므로 서버 부담이 거의 없고 빠른 액션, 충돌 처리가 가능하다. 슈팅, 액션, 레이싱, 스포츠 게임 등에서 P2P를 많이 사용했으나 이 경우 핵이 문제가 되며 로직이 분산되므로 동기화가 어려워져 판정에 어려움이 생긴다. 기본적인 컨트롤과 이동은 P2P로, 아이템 사용 등 중요한 로직은 CS로 처리하는 경우도 있다.

참고로 배그의 경우 100명 내외로 MO라 하기엔 애매하다. 배그는 언리얼 데디케이트 서버를 사용하면서 네트워크 로직에서는 CS를 따르고 있으나, 충돌처리 등의 판정은 클라에서 하는 것으로 추정된다. 그래서 이런 저런 핵이 존재하는데 대표적인 게 갑툭튀를 피하지 못하는 것이다. 락스택을 통해 프레임을 동기화함으로써 해결할 수 있으나 인원이 많을 경우 이런 동기화는 사용할 수 없다.

# **3. Super P2P / HOST P2P**
 
방 만들어서 하는 게임들이 주로 이 방식을 사용한다. 최근엔 MO류 게임이 매치메이킹을 사용하지만 과거에는 방을 찾아서 들어갔다. 이 경우 호스트 역할의 클라이언트가 서버가 되고 참가자들이 그 클라이언트에 연결한다. 참고로 언리얼의 데디케이트 서버도 누군가의 컴퓨터를 서버로 잡고 거기에 타 유저가 연결되는 방식을 사용한다. 이때 잡힌 사람의 레이턴시가 제일 낮게 나타나고 조금 더 유리하게 된다.

문제는 호스트가 공유기를 사용할 경우 해당 컴퓨터를 서버로 사용할 수 없게 된다. 따라서 공유기 사용자는 호스트가 되지 못하게 하거나, 우회하는 서버를 만들거나 하는 방식으로 이를 보완한다. 실질적인 로직은 각각 클라이언트에서 이루어지고 네트워크 로직 등의 경유지로 호스트 컴퓨터를 사용하는 경우가 일반적이다. 호스트 컴퓨터가 로직까지 처리하는 경우도 있으나 응답성 문제로 많지는 않다. 

**+) Dedicate Server**

하나의 게임 단위로 서버가 생성되고 소멸되는 구조를 일반적으로 dedicate server 방식이라고 부른다. MMORPG는 서버가 계속 존재하는 반면 오버워치, 배그와 같은 게임은 한 게임이 시작될 때 서버가 켜졌다가 종료되면 꺼진다. 로스트아크의 경우 전체 서버와 별개로 인던 서버들이 단독으로 존재하여 켜지고 꺼진다. 언리얼 dedicate server의 경우 게임이 실행될 때 observer와 같은 server가 존재해서 거기로 클라이언트들이 연결되는 느낌이다. 

# **4. 요즘 추세**

액션 MO 게임은 보통 P2P를 사용했으나, 최근에는 핵 문제로 점차 바뀌는 추세이다. 기존 P2P 게임도 CS 구조로 변경하거나 CS 구조의 검증 서버를 넣는 등 점차 개선되고 있다.  근데 또 서버 비용 문제 때문에 클라우드 게임 방식으로 바꾸려고 하는 곳도 있다고 한다. 실제로 배그의 경우 한 때 스테디아 방식으로 바꾸어봤는데 너무 느려서 금방 접었다고 한다.아직 응답성 및 클라우드 비용 문제로 활성화되지는 않았으나 계속 연구되고 있는 분야이다. 



