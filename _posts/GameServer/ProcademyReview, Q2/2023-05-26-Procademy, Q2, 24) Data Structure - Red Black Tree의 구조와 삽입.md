---
title: Procademy, Q2, 24) Data Structure - Red Black Tree의 구조와 삽입
categories: ProcademyReview
tags: 
toc: true
toc_sticky: true
---

이 포스트는 프로카데미 (게임 서버 아카데미) 수업을 바탕으로 공부한 내용을 정리한 것입니다. 

# **1. Red Black Tree**

**< 특징 >** 

**-** 각 노드는 부모의 포인터를 가진다. 

**-** 각 노드는 레드 혹은 블랙의 색상 값을 가진다.

**-** 리프 노드를 표현하기 위해 Nil 이라는 공통된 노드를 사용한다.

**< 노드 구성 조건 >** 

**-** 루트 노드와 리프 노드는 블랙이다.

**-** 레드 노드의 자식은 블랙이다. 연속된 레드가 올 수 없다.
	
**-** 루트노드부터 리프노드까지 모든 경로의 블랙 노드 수는 같다.

각 노드가 부모의 포인터를 갖는 것과 리프 노드가 Nil인 것은 계산의 편의를 위한 조건이다. Nil은 탐색, 삽입, 삭제 시에는 모두 nullptr과 동일하게 없는 노드로 취급하지만 회전하거나 밸런스를 잡을 때는 동일한 블랙 노드로 취급한다. 이를 사용하지 않으면 nullptr을 찌르지 않기 위해 계산이 더 복잡해진다. 

레드 블랙 트리에서 최악의 상황은 한쪽은 BBB, 한쪽은 BRBRB인 상황이다. AVL의 경우 자식의 depth를 매번 체크하여 모든 수가 동일하게끔 밸런스를 맞추기 때문에 완전히 균형 잡힌 상태를 유지하는 대신 삽입, 삭제 시 성능이 다소 떨어진다. 반면 레드 블랙 트리는 상대적으로 유연하면서도 depth가 2 이상 차이나지 않기 때문에 많이 사용한다. 

검증용 프로그램을 만들 때, 이진 트리는 정렬 순서대로 잘 들어있는지와 유실이 없는지만 파악하면 되지만 레드 블랙 트리는 모든 경로를 보면서 레드-레드 문제가 없는지와 경로 별 블랙 개수가 같은지도 함께 확인해야 된다. 데이터가 어떻게 위치하느냐에 따라 운 좋게 이진트리가 더 빠를 수도 있으나 데이터가 많아지면 대부분의 상황에서 RBT가 탐색이 더 빠르다.

<br/>

# **2. Red Black Tree의 삽입**

새로운 노드를 삽입할 때는 최대한 밸런스가 깨지지 않는 게 좋으니 일단 레드블랙트리 조건을 위반하지 않는 레드로 삽입한다. 이후 부모 노드의 색을 보고서 레드 자식으로 레드가 올 수 없다는 조건에 위배된다면 밸런스 작업을 거칠 것이다. 

만약 부모가 블랙이라면 별 처리 없이 바로 끝날 것이고, 부모가 레드라면 밸런스 잡는 코드를 반복하며 부모를 타고 올라가서 점점 넓은 범위로 밸런스를 잡을 것이다. 그렇게 해서 루트까지 도달하거나 내 부모가 블랙이 되면 루프가 종료된다. 이때 모든 경로에 대한 블랙노드의 개수가 일치해야 하므로 할아버지 노드를 기준으로 좌우의 균형도 맞아야 한다.

**1) 부모 레드, 삼촌 레드**

부모와 삼촌을 블랙으로 바꾸고, 할아버지는 레드로 바꾼다. 할아버지가 레드로 바뀜으로 인해서, 할아버지 상단의 색상도 모두 비교를 해보아야 한다. 따라서 할아버지를 새 노드로 잡고 반복문을 돌린다. 이 방법대로 ROOT 노드까지 올라가게 된다면 레드 노드가 된 ROOT 노드를 블랙으로 바꾸어준다. 이렇게 되면 모든 경로에 블랙 노드가 하나씩 추가된 셈이 된다. 

**2) 부모 레드, 삼촌 블랙, 현재 노드는 부모의 오른쪽 레드**

색상만 맞추는걸로 끝내지 않고, 회전을 통해 밸런스를 맞춰야 한다. 이때 회전을 위해서는 한쪽 방향으로 노드가 몰려있어야 한다. 따라서 부모기준으로 좌회전하여 신규노드를 부모의 위치로 올리고, 부모를 신규노드 왼쪽 자식으로 옮긴다. 이 과정을 거치면 2번 상황은 3번 상황으로 변경된다. 

이후 3번 상황에서 할아버지 노드의 우회전을 통해 상황을 해결을 하는데 이때 레드노드가 부모의 오른자식이면 할아버지 오른쪽으로 레드노드가 넘어간다. 3번에서는 할아버지 노드를 레드로 만들어서 해결할 예정이므로 이를 막기 위해 이런 작업을 해주는 것이다.

**3) 부모 레드, 삼촌 블랙, 현재 노드는 부모의 왼쪽 레드**

부모 노드를 블랙으로, 할아버지 노드를 레드로 바꾸고 할아버지 노드를 기준으로 우회전 한다. 이 과정을 통해 할아버지 노드 기준 좌우의 black 개수를 일치시키면서도 레드 노드가 연달아 오는 상황을 해결할 수 있다. 

   