---
title: TCP-IP 04) 연결 해제와 소켓 말소
categories: 1%Network
tags: 
toc: true
toc_sticky: true
---

이 포스트는 Tsutomu tone의 <성공과 실패를 결정하는 1%의 네트워크 원리(성안당)> 내용을 바탕으로 공부한 내용을 정리한 것입니다. 

# **1. 연결 해제**

데이터를 모두 송신 완료하고 나면 연결 끊기 단계로 들어가는데 웹의 경우 서버에서 응답 메시지를 반송한 후 먼저 연결을 끊는다. 이 경우 서버측의 애플리케이션이 먼저 소켓 라이브러리의 close를 호출하는데, 그러면 서버측의 프로토콜 스택이 TCP 헤더를 만들고, FIN bit를 1로 설정하여 IP 담당 부분에 의뢰해 클라에 송신한다. 이와 동시에 서버측 소켓에 연결 끊기 동작에 들어갔음을 기록한다. 

TCP 헤더가 도착하면 클라 측의 프로토콜 스택은 소켓에 서버측이 연결 끊기 동작에 들어갔음을 기록한다. 그리고 ACK 번호를 서버측에 반송하고, 애플리케이션이 read를 호출하면 데이터를 건네는 대신 서버에서 데이터를 전부 수신했다고 알린다. 이 정보를 받으면 클라 측 애플리케이션도 close를 호출하고, 클라 측 프로토콜 스택도 마찬가지로 FIN bit가 1인 TCP 헤더를 서버에 송신, 서버가 ACK 번호를 보내며 대화가 종료된다. 이 과정에서 재송신이 필요할 수도 있기 때문에, 대화 종료 후 몇분뒤에 소켓을 말소한다. 

