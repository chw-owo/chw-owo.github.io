---
title: LAN 02) 스위칭 허브의 패킷 중계
categories: 1%Network
tags: 
toc: true
toc_sticky: true
---

이 포스트는 Tsutomu tone의 <성공과 실패를 결정하는 1%의 네트워크 원리(성안당)> 내용을 바탕으로 공부한 내용을 정리한 것입니다. 

# **1. 스위칭 허브 동작 방식**

스위칭 허브는 이더넷의 패킷을 목적지로 중계하는 역할을 한다. 

스위칭 허브는 리피터 허브와 연결되는 커넥터-PHY(MAU)-MAC-메모리 버퍼-스위치 회로 그리고 MAC 주소표로 이루어져있다. 먼저 커넥터와 PHY(MAU) 회로는 MDI-X로 접속되어 있으며 신호가 커넥터에 도달하면 PHY(MAU) 회로로 수신되어 공통 신호 형식으로 변환 후 MAC 회로로 넘긴다. MAC 회로는 신호를 디지털 데이터로 변환하여 FCS를 체크하고 문제가 없을 시 버퍼메모리에 저장한다. 

이와 같이 커넥터와 연결된 회로들을 묶어서 포트라고 부른다. 스위칭 허브의 각 포트는 PC의 LAN 어댑터와 유사한 구조로 이루어져있다. 그러나 LAN 어댑터에는 MAC 주소가 할당되어 자신에게 온 패킷이 아닐 경우 폐기하는 반면, 스위칭 허브의 포트에는 MAC 주소가 할당되어 있지 않으며 모든 패킷을 버퍼 메모리에 저장한다는 점에서 차이가 있다. 

패킷을 버퍼 메모리에 저장하면 수신처 MAC 주소와 일치하는 것이 MAC 주소표에 등록되어 있는지 조사하고 이를 바탕으로 어느 포트에 송신할지 판단한다. 그 후 패킷은 스위치 회로를 경유하여 목적지로 향하는 포트에 보내진다. 스위치 회로는 신호선이 스위치를 통해 격자모양으로 배치되어 있으며 전자적 개폐를 통해 신호가 흐르는 대상을 제어할 수 있게 되어있다. 그리고 입력측은 수신측 포트에, 출력측은 송신측 포트에 각각 접속되어 있다. 

스위치 회로를 경유해 송신측 포트에 패킷을 운반하면 MAC, PHY(MAU)가 차례로 송신 동작을 실행하고 케이블에 신호를 흘린다. 반이중 모드라면 LAN 어댑터의 송신동작과 마찬가지로 아무도 송신 중이지 않다는 것을 확인한 후에 신호를 흘릴 것이며, 송신 동작 중에 수신 신호를 감시하는 것과 재밍 신호를 이용하는 것도 동일하게 동작한다. 

스위칭 허브가 리피터 허브에 접속되어 있을 때, 만일 송신 포트와 수신 포트가 동일하다면 패킷이 리피터 허브가 전체에 뿌렸을 때 한번, 스위칭 허브가 중계했을 때 한번 전송되면서 목적지에 두 개의 동일한 패킷이 도착할 것이다. 이를 막기 위해 스위칭 허브는 수신 포트와 송신 포트가 같을 경우 패킷을 폐기한다. 

스위칭 허브는 수신처 MAC 주소의 기기가 존재하는 포트 이외에는 송신 동작을 실행하지 않으므로 다른 포트는 빈 상태가 된다. 따라서 여기에도 별도의 패킷을 흘릴 수 있으며, 이를 통해 여러개의 패킷을 중계할 수도 있다. 리피터 허브는 들어온 신호를 모든 포트에서 뿌리기 때문에 충돌 문제로 인해 복수의 신호를 동시에 흘릴 수 없다.

# **2. 스위칭 허브와 주소표**

스위칭 허브는 스스로 MAC 주소표를 갱신한다. 갱신애는 두가지가 있는데 첫번째는 패킷 수신 시 송신처 MAC 주소를 조사하여 수신한 입력 포트 번호와 함께 주소표에 등록하는 것이다. 이를 통해 해당 주소로 패킷을 수신했을 때 쉽게 중계할 수 있다. 두번째는 오래된 주소를 주소표에서 삭제하는 것이다. 이를 통해 사용자가 수동으로 주소를 갱신하지 않아도 중계할 수 있게 된다. 

MAC 주소표에 일치하는 주소가 등록되어 있지 않은 경우, 우선 수신 포트 이외의 전체 포트에 패킷을 송신하게 된다. 다른 기기에 도착하는 경우 알아서 패킷을 폐기하기 때문에 문제가 되지 않는다. 응답이 돌아오면 그 주소를 MAC 주소표에 등록하여 이후 패킷부터는 직접 전송할 수 있게 된다. 또, MAC 주소가 브로드캐스트인 경우에도 수신 포트 외 모든 포트에 송신한다. 

<br/>

# **2. 전이중 모드와 자동 조정**

전이중 모드는 송수신을 동시에 실행할 수 있는 것으로, 리피터 허브는 사용할 수 없는 스위칭 허브만의 특징이다. 리피터 허브와 달리 스위칭 허브는 송/수신용 신호선이 나뉘어져 있어서 송수신 도중 충돌하지 않기 때문이다. 전이중 모드를 사용하면 양방향 동시 송신이 가능하므로 송신 가능 데이터 양의 상한선도 높아지고 속도도 빨라진다. 

처음엔 수동으로 동작 모드를 전환해야 했으나 최근에는 접속 상대가 어떤 모드를 지원하는지 검출하여 자동으로 전환해준다. 또, 상대의 전송 속도를 검출하여 적절 속도 역시 자동으로 전환하는데 이러한 기능들을 자동 조정이라고 한다. 이더넷은 데이터가 없을 때 링크 펄스라는 신호를 흘림으로써 단선 여부를 확인함과 동시에 지원 가능 모드 및 전송 속도에 대한 정보를 통지한다. 자동 조정 기능은 이러한 펄스 신호를 바탕으로 최적의 조합을 설정하는 것이다. 

