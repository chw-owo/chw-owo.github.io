---
title: Web Browser 03) 전세계의 DNS가 연대하기
categories: 1%Network
tags: 
toc: true
toc_sticky: true
---

이 포스트는 Tsutomu tone의 <성공과 실패를 결정하는 1%의 네트워크 원리(성안당)> 내용을 바탕으로 공부한 내용을 정리한 것입니다. 

# **1. DNS 서버의 기본 동작**

DNS 서버는 조회 메시지를 받고 그에 응답하는 역할을 하는데 이때 조회 메시지는 이름, 클래스, 타입에 대한 정보를 포함한다. 조회 메시지를 받으면 메시지 내용과 세 항목이 모두 일치하는 것을 찾아 그 값으로 회답하는 것이 DNS 서버의 기본 동작이다. 조회를 위한 등록 정보는 설정 파일에 입력되어 있으며, 이러한 등록 정보 중 1건 분의 등록 정보를 두고 리소스 레코드라고 부른다. 

이름은 서버, 메일 주소와 같은 이름이다. 클래스는 인터넷 외 네트워크 이용을 대비하여 만들어졌으나 현재는 인터넷을 의미하는 IN만 사용되고 있다. 타입은 어떤 타입의 정보가 지원되는지를 나타내며, 대표적으로 A는 IP 주소를, MX는 메일 배송 목적지를 의미한다. 이 외에도 IP 주소에서 이름을 조사할 때 쓰는 PTR, 이름에 닉네임을 붙이기 위한 CNAME, DNS 서버의 IP 주소인 NS, 도메인 속성 정보인 SOA 등 다양한 타입이 있다. 

예를 들어 메일 배송 목적지로서 chw-owo@gmail.com를 조회할 경우, 이름은 gmail.com, 클래스는 IN, 타입은 MX가 된다. (메일 배송 목적지의 경우 @ 뒤에 있는 값이 이름이 된다.) 타입이 MX인 경우 메일 서버의 우선 순위와 메일 서버의 이름이라는 두 항목이 등록되어 있기 때문에 두개의 항목에 대해 회답하는데, 우선순위는 복수의 메일 서버가 등록되어 있을 때는 어떤 것을 선택할지 판단하기 위해 존재한다. 그리고 이때 메일 서버의 IP 주소도 함께 회답하게 된다.

<br/>

# **2. 도메인명과 DNS**

세상에는 막대한 수의 서버가 있기 때문에, DNS 서버는 정보를 분산하여 다수의 DNS에 등록하고 이들끼리 연대하여 정보를 찾는 구조를 사용한다. 이를 위해 DNS에 등록된 정보에는 도메인명이라는 계층적 구조의 이름이 붙여진다. 예를 들어 www.cyber.co.kr이 있다면 kr은 한국에 할당된 최상위 도메인이며 co는 국내 도메인을 분류하기 위한 하위 도메인, cyber은 회사에 할당된 하위 도메인, 최하위 www가 서버의 이름이 될 것이다. 

엑세스 대상의 서버가 어느 DNS 서버에 등록되어 있는지 원활하게 찾기 위해, 하위 도메인을 담당하는 DNS 서버의 IP 주소를 상위 DNS 서버에 등록한다. 실제로 com, kr 등과 같은 최상위 도메인 위에 또 하나의 루트 도메인이 있으며, 전세계에 13개 뿐인 루트 도메인의 DNS 서버 주소는 인터넷 상의 모든 DNS 서버에 등록되어 있다. 이렇게 하면 모든 DNS 서버에서 루트 도메인에 접근하여, 차례로 거슬러 내려가며 주소를 찾을 수 있게 된다.

![image](https://user-images.githubusercontent.com/96677719/224878326-15fd0b14-347f-45eb-9582-77d38af521b2.png)

가장 가까운 DNS 서버에 내가 찾고자 하는 주소가 없을 경우, 그 DNS에 등록되어 있는 루트 도메인의 DNS 서버에 조회 메시지를 전송하게 된다. 그럼 루트 도메인은 com 도메인의 DNS 서버 IP 주소를 반송하고, 가장 가까운 DNS는 반환 받은 com 도메인 DNS 서버에 조회 메시지를 보낸다. 이런 식으로 IP 주소를 반환 받고 메시지를 보내는 것을 반복하면 원하는 DNS 서버에 도달하여 IP 주소를 응답받게 된다. 

이때 매번 이런 과정을 거치는 것은 비효율적이므로, DNS 서버는 한번 조사한 이름을 캐시에 기록하여 빠르게 회답할 수 있도록 한다. 그러나 등록 정보는 변경될 수 있으므로 이 값이 늘 유효하진 않다. 따라서 등록 정보에는 이를 대비한 유효기간이 설정되며, 이 유효기간이 지나게 되면 캐시에서 삭제된다. 또, 조회에 회답할 때 정보를 캐시에서 불러왔는지 등록처 DNS에서 불러왔는지에 대한 것도 함께 알려준다. 
