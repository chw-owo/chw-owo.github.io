---
title: Procademy, Q2, 02) Network, Basic - OSI 7 Layer
categories: ProcademyReview
tags: 
toc: true
toc_sticky: true
---

이 포스트는 프로카데미 (게임 서버 아카데미) 수업을 바탕으로 공부한 내용을 정리한 것입니다. 

# **0. OSI 7 계층이란?**

OSI 7 계층은 네트워크 구축을 위해 계층별로 역할을 분담하도록 정한 표준 규격으로, 권장 사항일 뿐 반드시 따라야 하는 필수 사항은 아니다. 실제로 TCP/IP도 역할을 7계층 대신 4계층으로만 나누며 L1은 L2에, L5와 L6은 L7에 포함시키고 있다. 그러나 작업할 때 L2 스위치, L6 방화벽과 같은 용어를 바탕으로 소통하므로 7계층은 명확하게 숙지해야 한다. 또, 계층 별로 메시지, 패킷, 세그먼트, 프레임 등의 용어가 조금씩 다른데 일반적으로 얘기할 때는 "패킷"을 많이 쓰지만, 문제를 파악할 때 등의 상황에서는 명확한 용어를 쓰기를 권장한다. 

<br/>

# **1. L1 물리 계층**

0/1bit의 데이터를 전기적 신호로 변경하여 실질적인 전송을 하는 계층으로, 데이터 전송 단위로 bit를 사용한다. 물리적인 전기선, 무선 연결 전파 등이 L1에 해당하며 주된 장비로는 허브, 리피터 등이 있다. 프로그래밍 측면에서는 계층으로서의 존재 이유가 약해서 TCP/IP에서는 L2와 함께 하나의 네트워크 인터페이스 계층으로 묶고 있다. 

<br/>

# **2. L2 데이터 링크 계층**

물리 계층을 향해 데이터를 신뢰성 있게 전송하는 계층으로, 데이터 전송 단위로 frame을 사용한다. 네트워크 계층에서 받은 데이터를 frame으로 만들어 물리 계층으로 전송하며, 이더넷 프로토콜이 대표적으로 사용된다. 주된 장비로는 LAN 카드, L2 스위치가 있다. 여기서 신뢰성이란 오류난 데이터가 없도록 하겠다는 의미로, 대부분의 경우 복원이 아닌 폐기를 의미한다.만약 CRC 해시 코드 등으로 오류를 검출했을 때 심한 노이즈가 발견된다면 그대로 폐기한다. 

LAN 카드는 아날로그 신호를 디지털로 바꿔서 위 계층에 올려주는 역할을 한다. 이 계층에서는 MAC 주소를 사용하며 모든 네트워크 장비에는 MAC 주소가 부여된다. 이는 세계에서 유일한 번호로 일종의 물리적 주소, 하드웨어 주소라고 볼 수 있다. MAC은 이더넷 프로토콜에서 쓰는 표준 주소이며, 이더넷 장비라고 하면 이더넷 규격을 따르는 LAN 카드를 의미한다. 여러 기기가 동일한 MAC 주소를 가질 수도, 한 기기가 여러가지 MAC 주소를 가질 수도 있다. 이는 IP 주소도 마찬가지이다. 

고유한 번호다 보니 MAC 주소로 금지시키면 그 하드웨어에서 접근할 수 없게 된다. 물론 LAN을 바꾸면 다시 접근 가능하다. 참고로 요즘 공유기들은 MAC 주소 변경 기능이 있는데, 이때도 같은 LAN 안에서는 동일한 MAC 주소를 가질 수 없다. 이때, L2 입장에서는 WAN을 전혀 고려하지 않으므로 동일 LAN에서의 중복만 피하면 인터넷 전체에서는 중복되어도 아무 상관 없다. 인터넷은 L3가, LAN은 L2가 각각 담당하기 때문이다.

<br/>

# **3. L3 네트워크 계층**

패킷을 "송신측"으로부터 "수신측"으로 전송하는 계층으로 데이터의 전송 경로를 결정한다. 데이터 전송 단위로 packet을, 프로토콜로는 IP, ARP 등을 사용한다. L2까지는 "장치"와 "장치" 간의 데이터 전송만을 담당하지 출발지와 목적지에 대한 정보를 사용하지 않았다. IP 논리 주소를 바탕으로 이번 단계에서 어디로 향하면 되는지 결정하는 것이 L3 네트워크 계층의 역할이다. 이 때문에 이 계층을 설명할 때는 경로, 송신측, 수신측이라는 용어가 등장하게 된다. 

<br/>

# **4. L4 전송 계층**

오류 복구, 흐름 제어등을 담당하며 두 시스템 간 신뢰성 있는 데이터 전송을 보장한다. TCP, UDP 프로토콜을 사용하며 데이터 전송 단위로는 각각 Segment와 Datagram을 사용한다. 주된 장비로는 게이트웨이, 로드밸런서 등이 있다. 이 계층은 port를 프로세스에 대한 주소처럼 사용한다. 한 프로세스는 여러 개의 포트를 가질 수 있지만 한 포트는 하나의 프로세스만 가진다. 지금까지 언급된 L2 ~ L4는 커널 영역에서 작업이 이루어진다. 

<br/>

# **5. L5 세션 계층**

응용 프로그램 계층 간 통신에 대한 규격, 접속 설정을 동기화. 전송계층에 전송 순서를 정해주고 점검과 복구를 위한 위치를 제공한다. 데이터 전송 단위로 message을 사용하며, NetBIOS, SSH 등의 프로토콜을 사용한다. 

<br/>

# **6. L6 표현 계층**

응용 계층의 다양한 표현 양식을 범용적 전송 방식으로 전환하고 이에 대한 암호화, 복호화, 데이터 압축 등을 진행한다. 데이터 전송 단위로 message을 사용하며 JPG, MPEG 등의 프로토콜을 사용한다. 

<br/>

# **7. L7 응용 계층**

어플리케이션 계층을 의미한다. 데이터 전송 단위로 message을 사용하며, HTTP, FTP, DNS 등의 프로토콜을 사용한다. TCP에서는 L5, L6 기능을 L7에 묶고 있기 때문에 해당 계층의 작업도 일반적으로 L7 개발자가 함께 처리한다.

<br/>

# **8. 모바일 기기와 UDP**

UDP는 직접 구현해야 하는 부분이 많아서 원래 많이 쓰이지 않았는데, 모바일 기기 등장을 계기로 최근에 많이 사용되고 있다. TCP는 IP와 port를 기반으로, L4에서 패킷을 보내 연결을 하고, 그 연결을 바탕으로 통신을 한다. 그러나 모바일 환경에서는 IP가 계속 변할 수 있기 때문에 연결도 계속 끊기게 되며, TCP의 연결 기능의 장점을 제대로 활용하기 어렵다. 이로 인해 최근에는 Reliable-UDP를 구현해서 쓰는 곳이 많아지고 있다. 언리얼 데디케이트 서버, 블리자드 등도 UDP를 사용한다. 

이때, TCP를 사용할 때는 아무리 send 해도 상대방이 받지 않으면 보내지지 않기 때문에 디도스 공격이 불가능했지만, UDP는 별도의 방어책을 마련해야 한다. 반면 UDP가 TCP에 비해 장점을 갖는 것도 있는데, TCP는 기본으로 붙는 헤더 자체가 긴 반면 UDP는 헤더 전체가 8byte이기 때문에 네트워크 비용을 절약할 수 있다. 

<br/>

# **9. 네트워크 명령어**

ipconfig에서 나오는 물리적 주소가 MAC 주소이며, 그 중 앞의 3개가 제조사 고유 주소이다. IPv6의 경우 연결 과정에서 한 단계가 추가될 뿐 기본적인 통신 동작의 방식은 동일하다. 

netstat은 연결된 네트워크를 보여준다. 외부 주소 링크를 묻는 과정이 포함되기 때문에 느리다. 이를 생략하려면 -n을, 포트의 프로세스 id를 보려면 -o를, 열려 있지만 연결되지 않은 포트 혹은 UDP 포트도 보려면 -a를 사용한다. ESTABLISHED는 통신 중임을 의미한다. OS 차원에서 기본으로 열어두는 포트가 많은데 필요 없는 것은 막는 게 더 안전하다. 조금 느려도 아이콘과 함께 보기 좋게 보려면 TCPView를 쓸 수 있다. 

