---
title: Procademy, Q1, 12) 게임 서버의 분산
categories: ProcademyReview
tags: 
toc: true
toc_sticky: true
---

이 포스트는 프로카데미 (게임 서버 아카데미) 수업을 바탕으로 공부한 내용을 정리한 것입니다. 

# **1. 게임 서버의 분산**

서버가 감당할 수 있는 최대 인원이 가득 차서 서버를 늘리게 되면 보통 월드, 채널 등을 늘리고 그 사이의 통신을 막아버리는 방식으로 처리했다. 그게 가장 간편한 방법이기 때문이다. 이때, 로그인을 위한 서버만 따로 둔다면 월드를 병렬적으로 계속 늘리는 것은 어려운 일이 아니다. 반면 한 월드를 여러 서버로 분산할 때는 보다 다양한 것을 고려해야 하므로 여러가지 방법이 필요하게 된다. 

최근에는 한 서버가 여러 코어를 갖고 있는데다가 코어간의 통신도 지원이 되는 경우가 많아서 서버 분산이 많이 이루어지지는 않지만, 2000년대 초반 싱글 코어 시대에는 이러한 서버 분산을 어떻게 하는지가 중요한 이슈가 되었다고 한다. 최근에는 맵도, 기능도 스레드 단위로 분산이 이루어지지 서버를 물리적으로 분산하는 경우는 많지 않다. 따라서 2023년에 서버 개발자가 되려는 입장에서는 스레드를 어떻게 효율적으로 분산할지, 이들을 어떻게 동기화 할 지에 대해 고민하는 게 더 좋다. 

# **2. 지역(Map) 별 분리**

여러 개의 Map을 만들어놓고 한 서버에서 돌리다가, 이를 다시 여러 서버에 균등하게 나누는 것은 손이 많이 가는 작업이다. 따라서 처음부터 언젠가 분리할 수 있게끔 가정 해놓고 작업한 뒤, 필요할 때 하나씩 천천히 분리하는 방법을 주로 택한다. 예를 들어 만약 Map 1~30이 있다면 한번에 1~10 / 11~20 / 21~30 으로 분리하는 게 아니라 일단 가장 많이 모이는 로비부터 분리하고 (1~4, 6~30 / 5 / null) 그 다음 또 하나 분리하고, 또 하나 분리하는 것이다. 물론 이렇게 하려면 처음부터 분리 가능하게끔 개발을 해야한다.

물리적으로 분리된 컴퓨터에 올라가 있는 각각 플레이어들은 완벽하게 동기화 될 수 없다. 걸어다니고, 서로 보이고, 채팅하는 정도의 간단한 인터렉션의 경우 얼추 비슷하게 동기화할 수 있지만, 실시간성이 중요한 작업은 네트워크 통신 과정이 포함되므로 완전한 동기화가 어렵다. 그러므로 던전, 맵 단위로 분리해서 서로 인터랙션이 없게끔 하는 게 가장 깔끔하다. 만약 반드시 이어진 맵을 사용해야 된다면 서버가 연결되는 일정 구역을 서로 영향을 줄 수 없는 컨텐츠로 만드는 것과 같이 기획적으로 커버해야 한다. 

# **3. 기능적 분산**

게임서버와 채팅서버를 분리하는 것이 한 예시이다. 그 둘 사이 콘텐츠적 연관성이 없기 때문에 이게 그나마 단순한 방법이 된다. 하지만 요즘은 사람들이 게임 내 채팅 기능을 잘 사용하지 않아서 이 방법을 거의 사용하지 않는다. 정해진 법칙이 있다기보다는 게임의 성격, 컨텐츠에 따라 결정하면 된다.

기능을 분산 한 후에는 대부분 비동기 함수를 통해 기존 서버에 연동되도록 설계한다. 비동기는 요청만 던지고 그 이후 다른 작업을 처리하는 것을 의미하는 것으로, 다른 작업을 하다가 응답이 돌아오면 그때 뒤늦게 확인하고 관련 작업을 처리한다. 따라서 순서를 보장할 수 없으며 통신에 시간이 많이 걸리게 된다. 따라서 데이터를 송수신하는 부분이 감안해도 나누는 것이 더 효율적인 경우에만 서버를 분산하는 것이 좋다. 경매장이 분리해야 되는 영역의 대표적인 예시이며 AI, NPC는 그렇게까지 많이 부담을 주는 영역이 아니기 때문에 사실 분리할 가치가 높지 않다.


# **4. 질의응답**

Q. A게임은 거대한 맵을 헤엄쳐서/날아서 가로지르는 게 가능하던데 이는 어떻게 구현된 건가요? 

A. 한번에 끊이지 않고 이동하는 것은 분리된 서버여도 눈속임으로 충분히 구현할 수 있다. 타 유저가 보이는 건 되지만 상호작용은 안된다면 이건 보이기만 하게끔 분리된 서버일 가능성이 높고, 어디에서든 다른 유저와 상호작용까지 할 수 있다면 그건 하나의 서버여야 가능하다. 이런 부분은 개발자와 기획자가 초기 기획 단계에서부터 적극적으로 소통하여 구현해야 한다.
