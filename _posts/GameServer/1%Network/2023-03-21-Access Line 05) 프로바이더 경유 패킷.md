---
title: Access Line 05) 프로바이더 경유 패킷
categories: 1%Network
tags: 
toc: true
toc_sticky: true
---

이 포스트는 Tsutomu tone의 <성공과 실패를 결정하는 1%의 네트워크 원리(성안당)> 내용을 바탕으로 공부한 내용을 정리한 것입니다. 

# **1. 프로바이더 간 접속**

목적지 서버가 클라이언트와 같은 프로바이더에 접속되어 있는 경우, 프로바이더의 라우터는 라우터끼리 경로 정보를 교환하고 이를 경로표에 자동으로 등록한다. 중계 대상이 NOC이든 POP이든 중계 대상에 패킷을 보내면 이 라우터도 경로표를 따라 패킷을 중계하고, 목적지 서버측의 POP에 도착하면 거기서 웹서버로 향하게 된다. 그리고 서버측 프로바이더가 클라이언트측과 다른 경우에도, 프로바이더끼리는 경로 정보를 교환하기 때문에 중계 대상이 경로표에 등록되어 있으며 마찬가지로 중계를 이어가면 된다. 

<br/>

# **2. 프로바이더 간 경로 정보 교환**

프로바이더 간 경로 정보를 교환하고 이를 라우터에 등록하기 위해서 접속 상대가 경로 정보를 알려주게 된다. 상대가 경로 정보를 가르쳐주면 그곳에 어떤 네트워크가 있는지 알 수 있게 되며 가르쳐준 경로 정보를 경로표에 등록하여 패킷을 보낼 수 있게 된다. 그리고 이쪽에서도 같은 방법으로 경로 정보를 상대에게 통지하며, 상대 측에서 보내려고 한 패킷이 흘러오게 된다. 이러한 정보 교환은 라우터가 자동으로 수행하며 여기에 사용되는 구조를 BGP, Border Gateway Protocol이라고 한다. 

경로 정보 교환은 통지하는 내용에 따라 두가지로 나뉜다. 첫번째는 인터넷의 경로를 전부 상대에게 통지하는 것으로 이를 트랜지트라고 하며, 그 결과 자신 외의 모든 프로바이더에게 패킷을 보낼 수 있게 된다. 두번째는 두 프로바이더가 각각 네트워크에 대한 경로 정보만 상대에게 통지하는 것으로 이를 비트랜지트 혹은 피어라고 하며, 이렇게 할 경우 상대 네트워크로 갈 패킷만 흐르게 된다. 

사내 네트워크도 라우터끼리 경로 정보를 교환하여 경로표가 자동으로 설정되는 방법을 사용한다. 이때 사내 네트워크는 목적지까지 최단 경로를 찾아 패킷을 중계하도록 만들어졌기 때문에 주변에 있는 전체 라우터와 무차별적으로 경로 정보를 교환한다. 그러나 프로바이더에서는 다른 프로바이더의 패킷이 회선에 유입되면 비용 교섭이 어려워지기 때문에 이런 방법을 사용할 수 없다. 따라서 인터넷의 경우 프로바이더 간 경로 정보 교환이 특정 라우터와 1:1로 이루어지며, 비용 부담 교섭에 응한 상대에게만 경로 정보를 통지한다. 

<br/>

# **3. IX와 프로바이더 접속**

![image](https://user-images.githubusercontent.com/96677719/226109953-60b59590-26e0-4683-b59f-615c6b61afa8.png)

프로바이더끼리 접속하는 방법은 1:1 접속이 가장 기본이지만, 이 경우 복수의 프로바이더가 서로 연결된다면 우측 그림과 같이 아주 많은 회선이 필요하게 된다. 따라서 좌측과 같이 중심이 되는 설비를 설치하고 이를 경유하여 접속하도록 만듦으로써 회선 설치 비용을 줄이는데, 이때 중심이 되는 설비를 IX라고 한다. 이는 정전, 화재, 지진 등에도 정지하지 않도록 자가 발전 설비를 갖춘 내진 구조 건물 안에 만들어진다. 

IX의 중심에는 고속 LAN 인터페이스를 다수 장착한 레이어 2 스위치가 있으며, 여기에 광섬유 및 통신 회선 을 통해 프로바이더 라우터들을 연결한다. 이 스위치는 스위칭 허브와 동일하게 동작한다. ARP에 중계 대상 라우터의 MAC 주소를 조사하여 MAC 헤더에 기록하고 패킷을 보내는 것이다. 이때 경로 정보를 교환해야만 실제로 패킷을 보낼 수 있는데, 서로 계약 조건을 교섭하여 합의에 이른 상대하고만 경로 정보를 교환한다. 